#!/bin/bash

# Simple SSH_ASKPASS script to prompt for password
# Usage: Export this as SSH_ASKPASS environment variable
# Example: export SSH_ASKPASS=ssx-askpass


# shellcheck disable=SC2001
KEY=$(echo "$1" | sed "s/Enter passphrase for key.*'\([^']*\)'.*/\1/")
echo "Passphrase for Key: $KEY" >/dev/tty


# Check if zenity is available for GUI prompt
if command -v zenity >/dev/null 2>&1; then
    zenity --password --title="SSH Key Password Required for $KEY" 2>/dev/null
# Check if whiptail is available for terminal UI
elif command -v whiptail >/dev/null 2>&1; then
    whiptail --passwordbox "Please enter your SSH key password for $KEY:" 8 78 3>&1 1>&2 2>&3
# Fall back to simple terminal prompt
else
    echo -n "SSH key password for $KEY: " >/dev/tty
    read -rs password </dev/tty
    echo "$password"
fi
