#!/bin/bash

# Simple SSH_ASKPASS script to prompt for a password or passphrase
# Usage: Export this as SSH_ASKPASS environment variable
# Example: export SSH_ASKPASS=ssx-askpass-prompt

source bashlib-ssh.sh
source bashlib-echo.sh

# shellcheck disable=SC2001
KEY=$(echo "$1" | sed "s/Enter passphrase for key.*'\([^']*\)'.*/\1/")
echo::info "Passphrase for Key $(basename "$KEY")" >/dev/tty

# The prompt cli should be read, not zenity otherwise the stdout is messed up
# and you get:
#   Error: Received disconnect from UNKNOWN port 65535:11: Bye Bye
#   Disconnected from UNKNOWN port 65535
#   fatal: Could not read from remote repository.
ssh::get_secret_interactive "$1" "read"
