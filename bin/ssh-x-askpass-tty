#!/bin/bash
# SSH_ASKPASS script to prompt without a terminal


set -Eeuo pipefail
source bashlib-error.sh
error::set_trap

# The 1 parameter got Enter passphrase for key xxx
# The key can be extracted with the below command
# KEY=$(echo "$1" | sed "s/Enter passphrase for key.*'\([^']*\)'.*/\1/")
# But we let the original prompt from now
PROMPT=${1:-}

if [ "$PROMPT" == "" ]; then
  echo::err "A prompt label is expected as first argument"
fi

if [ "$PROMPT" == "synopsis" ]; then
  cat << EOF
\`\`\`bash
$(basename "$0") <Prompt Label>
\`\`\`
EOF
  exit
fi


echo "$PROMPT" >/dev/tty
read -rs password </dev/tty
echo "$password"
