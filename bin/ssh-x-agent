#!/usr/bin/env bash

set -Eeuo pipefail
# shellcheck source=../..//bash-lib/lib/bashlib-error.sh
source "${BASHLIB_LIBRARY_PATH:-}${BASHLIB_LIBRARY_PATH:+/}bashlib-error.sh"
source bashlib-error.sh
error::set_trap
# shellcheck source=../..//bash-lib/lib/bashlib-echo.sh
source "${BASHLIB_LIBRARY_PATH:-}${BASHLIB_LIBRARY_PATH:+/}bashlib-echo.sh"
# shellcheck source=../..//bash-lib/lib/bashlib-doc.sh
source "${BASHLIB_LIBRARY_PATH:-}${BASHLIB_LIBRARY_PATH:+/}bashlib-doc.sh"


# The synopsis function is required by the doc::usage
synopsis(){

  cat << 'EOF'
```bash
ssh-x agent command options
```

where `command` can be:

* `init`  - Start one agent by computer (not one by session)

EOF

}

###########
# Main
###########
COMMAND=""
while [[ $# -gt 0 ]]
do
   case "$1" in
    *)
      COMMAND=$1
      shift
      break
      ;;
    esac
done

if [ "$COMMAND" == "" ]; then
  doc::help
  echo::err "No command found"
  exit 1
fi
case "$COMMAND" in
  "init")
    ssh-x-agent-init "$@"
    ;;
  "synopsis")
    synopsis
    ;;
  *)
    doc::help
    echo::err  "Command $COMMAND is unknown"
    exit 1
esac