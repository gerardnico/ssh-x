.\" Automatically generated by Pandoc 2.17.1.1
.\"
.\" Define V font for inline verbatim, using C font in formats
.\" that render this, and otherwise B font.
.ie "\f[CB]x\f[]"x" \{\
. ftr V B
. ftr VI BI
. ftr VB B
. ftr VBI BI
.\}
.el \{\
. ftr V CR
. ftr VI CI
. ftr VB CB
. ftr VBI CBI
.\}
.TH "ssh-x-auth-proxy-command" "1" "" "Version Latest" "Proxy command to load private keys from public key"
.hy
.SH SSH Auth Proxy command
.SS About
.PP
The \f[V]SSH Auth Proxy command\f[R] is a command that will load your
private key if you use a public key as identity.
.SS Example
.SS Load a private key stored on the file system for one Host
.PP
With the example below, \f[V]ssh-x-auth-proxy-command\f[R] will: * check
if the private key of the public key
\f[V]\[ti]/.ssh/id_git_github.pub\f[R] is present (ie loaded in the
agent) * if not, it will add the private key located at
\f[V]\[ti]/.ssh/id_git_github\f[R] with a lifetime of
\f[V]15 minutes\f[R] * if the key is protected, it will ask for the
passphrase
.PP
With this \f[V]\[ti]/.ssh/conf\f[R] configuration
.IP
.nf
\f[C]
Host github.com
    # Public key as identity
    IdentityFile \[ti]/.ssh/id_git_github.pub
    # Proxy command
    ProxyCommand env BASHLIB_LIBRARY_PATH=/path/to/bash-lib/lib /path/to/ssh-x-auth-proxy-command %h %n %p %r
    # Lifetime
    AddKeysToAgent 15m
    # Generally needed (ie don\[aq]t try to use ssh-agent identity/keys)
    IdentitiesOnly yes
\f[R]
.fi
.PP
where:
.PP
Note that \f[V]env BASHLIB_LIBRARY_PATH=/path/to/bash-lib/lib\f[R] set
the library location of bash
lib (https://github.com/gerardnico/bash-lib) and is mandatory for editor
as they don\[cq]t take any Shell environment variable.
.SS Load a private key stored in the pass password manager store
.PP
With the same configuration as previously but with the pass manager as
key store
.PP
Change the key store to \f[V]pass\f[R] by setting the following
environment variable in your \f[V].bashrc\f[R]
.IP
.nf
\f[C]
export SSH_X_KEY_STORE=pass
\f[R]
.fi
.PP
With this environment, \f[V]ssh-x-auth-proxy-command\f[R] will: * check
if the private key of the public key
\f[V]\[ti]/.ssh/id_git_github.pub\f[R] is present (ie loaded in the
agent) * if not, it will add the private key located at
\f[V]ssh/id_git_github\f[R] with a lifetime of \f[V]15 minutes\f[R]
.PP
Because the private key is in the pass
manager (https://www.passwordstore.org/), the key is already protected
and would have no passphrase but if this is the case, we still ask for
the passphrase
.SS How to configure for all hosts
.PP
This example shows you how you can configure \f[V]ssh\f[R] to use
\f[V]ssh-x-auth-proxy-command\f[R] for all hosts thanks to the SSH
template features.
.PP
For the \f[V]IdentityFile\f[R], \f[V]ssh\f[R] supports the following
placeholder: * \f[V]%h\f[R] : The remote hostname * \f[V]%n\f[R] : The
original remote hostname * \f[V]%p\f[R] : The remote port * \f[V]%r\f[R]
: The remote username *
.PP
Example in the \f[V]\[ti]/.ssh/conf\f[R]
.IP
.nf
\f[C]
Host *
    # Public key as identity
    IdentityFile \[ti]/.ssh/id_%r_%h.pub
    # Proxy command
    ProxyCommand env BASHLIB_LIBRARY_PATH=/path/to/bash-lib/lib /path/to/ssh-x-auth-proxy-command %h %n %p %r
    # Lifetime
    AddKeysToAgent 30m
    # Generally needed (ie don\[aq]t try to use ssh-agent identity/keys)
    IdentitiesOnly yes
\f[R]
.fi
.PP
If you use \f[V]github\f[R]: * the \f[V]IdentityFile\f[R] file would be
\f[V]\[ti]/.ssh/id_git_github.com.pub\f[R] * the corresponding
\f[V]Private Key\f[R] file would be located: * on the file system at:
\f[V]\[ti]/.ssh/id_git_github.com\f[R] * in \f[V]pass\f[R] at:
\f[V]ssh/id_git_github.com\f[R] * the lifetime for the key would be
\f[V]30 minutes\f[R]
.SS Usage
.IP
.nf
\f[C]
ssh-x-auth-proxy-command dnsHostname sshHostName port user
# in the \[ga]\[ti]/.ssh/conf\[ga] with placeholder
ssh-x-auth-proxy-command %h %n %p %r
\f[R]
.fi
.PP
You use it in the
ProxyCommand (https://man.openbsd.org/ssh_config#ProxyCommand) conf of
your SSH configuration file (\f[V]\[ti]/.ssh/conf\f[R])
.IP
.nf
\f[C]
Host *
    # Proxy command
    ProxyCommand env BASHLIB_LIBRARY_PATH=/path/to/bash-lib/lib /path/to/ssh-x-auth-proxy-command %h %n %p %r
    # Your identity file should be a Public Key
    IdentityFile \[ti]/.ssh/id_git_github.pub
\f[R]
.fi
.PP
Note that \f[V]env BASHLIB_LIBRARY_PATH=/path/to/bash-lib/lib\f[R] set
the library location of bash
lib (https://github.com/gerardnico/bash-lib) and is mandatory for editor
as they don\[cq]t take over any Shell environment variable.
.SS Prerequisites
.PP
Your Identity (https://man.openbsd.org/ssh_config#IdentityFile) should
be a public key
.SS Environment
.PP
See \f[V]ssh-x-env(1)\f[R]
.SS How to
.SS How to add your private key to pass
.PP
To add the private key \f[V]\[ti]/.ssh/id_git_github.com\f[R] into pass
at \f[V]ssh/id_git_github.com\f[R], you would use this command:
.IP
.nf
\f[C]
cat \[ti]/.ssh/id_git_github.com | pass insert -m \[dq]ssh/id_git_github.com\[dq];
\f[R]
.fi
