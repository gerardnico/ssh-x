.\" Automatically generated by Pandoc 2.17.1.1
.\"
.\" Define V font for inline verbatim, using C font in formats
.\" that render this, and otherwise B font.
.ie "\f[CB]x\f[]"x" \{\
. ftr V B
. ftr VI BI
. ftr VB B
. ftr VBI BI
.\}
.el \{\
. ftr V CR
. ftr VI CI
. ftr VB CB
. ftr VBI CBI
.\}
.TH "ssh-x-auth-proxy-command" "1" "" "Version Latest" "Proxy command to load private keys from public key"
.hy
.SH SSH Auth Proxy command
.SS About
.PP
The \f[V]SSH Auth Proxy command\f[R] is a command that will load your
private key if you use a public key as identity.
.SS Example
.SS Load a private key stored on the file system for one Host
.PP
With this \f[V]\[ti]/.ssh/conf\f[R] configuration
.IP
.nf
\f[C]
Host github.com
    # Public key as identity
    IdentityFile \[ti]/.ssh/id_git_github.pub
    # Proxy command
    ProxyCommand ssh-x-auth-proxy-command %h %n %p %r
    # Lifetime
    AddKeysToAgent 15m
    # Generally needed (ie don\[aq]t try to use ssh-agent identity/keys)
    IdentitiesOnly yes
\f[R]
.fi
.PP
\f[V]ssh-x-auth-proxy-command\f[R] will: * check if the private key of
the public key \f[V]\[ti]/.ssh/id_git_github.pub\f[R] is present (ie
loaded in the agent) * if not, it will add the private key located at
\f[V]\[ti]/.ssh/id_git_github\f[R] with a lifetime of
\f[V]15 minutes\f[R] * if the key is protected, it will ask for the
passphrase
.SS Load a private key stored in the pass password manager store
.PP
With the same configuration as previously but with the pass manager as
key store
.PP
Change the key store to \f[V]pass\f[R] by setting the following
environment variable in your \f[V].bashrc\f[R]
.IP
.nf
\f[C]
export SSHX_KEY_STORE=pass
\f[R]
.fi
.PP
With this environment, \f[V]ssh-x-auth-proxy-command\f[R] will: * check
if the private key of the public key
\f[V]\[ti]/.ssh/id_git_github.pub\f[R] is present (ie loaded in the
agent) * if not, it will add the private key located at
\f[V]ssh/id_git_github\f[R] with a lifetime of \f[V]15 minutes\f[R]
.PP
Because the private key is in the pass
manager (https://www.passwordstore.org/), the key is already protected
and would have no passphrase but if this is the case, we still ask for
the passphrase
.SS How to configure for all hosts
.PP
This example shows you how you can configure \f[V]ssh\f[R] to use
\f[V]ssh-x-auth-proxy-command\f[R] for all hosts thanks to the SSH
template features.
.PP
For the \f[V]IdentityFile\f[R], \f[V]ssh\f[R] supports the following
placeholder: * \f[V]%h\f[R] : The remote hostname * \f[V]%n\f[R] : The
original remote hostname * \f[V]%p\f[R] : The remote port * \f[V]%r\f[R]
: The remote username *
.PP
Example in the \f[V]\[ti]/.ssh/conf\f[R]
.IP
.nf
\f[C]
Host *
    # Public key as identity
    IdentityFile \[ti]/.ssh/id_%r_%h.pub
    # Proxy command
    ProxyCommand ssh-x-auth-proxy-command %h %n %p %r
    # Lifetime
    AddKeysToAgent 30m
    # Generally needed (ie don\[aq]t try to use ssh-agent identity/keys)
    IdentitiesOnly yes
\f[R]
.fi
.PP
If you use \f[V]github\f[R]: * the \f[V]IdentityFile\f[R] file would be
\f[V]\[ti]/.ssh/id_git_github.com.pub\f[R] * the corresponding
\f[V]Private Key\f[R] file would be located: * on the file system at:
\f[V]\[ti]/.ssh/id_git_github.com\f[R] * in \f[V]pass\f[R] at:
\f[V]ssh/id_git_github.com\f[R] * the lifetime for the key would be
\f[V]30 minutes\f[R]
.SS Usage
.IP
.nf
\f[C]
ssh-x-auth-proxy-command dnsHostname sshHostName port user
# in the \[ga]\[ti]/.ssh/conf\[ga] with placeholder
ssh-x-auth-proxy-command %h %n %p %r
\f[R]
.fi
.PP
You use it in the
ProxyCommand (https://man.openbsd.org/ssh_config#ProxyCommand) conf of
your SSH configuration file (\f[V]\[ti]/.ssh/conf\f[R])
.IP
.nf
\f[C]
Host *
    # Proxy command
    ProxyCommand ssh-x-auth-proxy-command %h %n %p %r
    # Your identity file should be a Public Key
    IdentityFile \[ti]/.ssh/id_git_github.pub
\f[R]
.fi
.SS Prerequisites
.PP
Your Identity (https://man.openbsd.org/ssh_config#IdentityFile) should
be a public key
.SS Key Store
.PP
We support 2 keys store: * \f[V]file\f[R]: where the key is stored in a
file system directory (default) * \f[V]pass\f[R]: where the key is
stored in the pass password manager (https://www.passwordstore.org/)
.PP
You choose your key store with the variable SSHX_KEY_STORE
.PP
For the 2 stores, the key is located at \f[V]/KeyName\f[R] where : *
SSHX_KEY_HOME defines the directory location.
* \f[V]KeyName\f[R] is the name of the private key (ie the public key
without the \f[V].pub\f[R] extension)
.SS Environment
.IP \[bu] 2
\f[V]SSHX_KEY_STORE\f[R]: the name of the key store that contains the
private key.
Possible values:
.RS 2
.IP \[bu] 2
\f[V]file\f[R]: (default) for the file system
.IP \[bu] 2
\f[V]pass\f[R]: for the pass password
manager (https://www.passwordstore.org/)
.RE
.IP \[bu] 2
\f[V]SSHX_KEY_HOME\f[R]: a path to the directory containing your private
keys.
Default to:
.RS 2
.IP \[bu] 2
\f[V]\[ti]/.ssh\f[R] for a file key store
.IP \[bu] 2
\f[V]ssh\f[R] for the pass key store
.RE
.IP \[bu] 2
\f[V]SSHX_LIFE\f[R]: the default lifetime of the loaded keys (Default to
\f[V]15m\f[R]) Used if a time interval is not found in the
\f[V]AddKeysToAgent\f[R] conf.
.IP \[bu] 2
\f[V]SSH_ASKPASS\f[R]: to set how to retrieve the password.
By default, we prompt with ssh-x-askpass-prompt
.SS How to
.SS How to add your private key to pass
.PP
To add the private key \f[V]\[ti]/.ssh/id_git_github.com\f[R] into pass
at \f[V]ssh/id_git_github.com\f[R], you would use this command:
.IP
.nf
\f[C]
cat \[ti]/.ssh/id_git_github.com | pass insert -m \[dq]ssh/id_git_github.com\[dq];
\f[R]
.fi
